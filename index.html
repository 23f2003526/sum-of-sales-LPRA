<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sales Summary 123123</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<style>
  body {
    min-height: 100vh;
  }
</style>
</head>
<body class="bg-light d-flex flex-column justify-content-center align-items-center py-5">
  <div class="container">
    <h1 class="mb-4 text-center">Sales Summary 123123</h1>
    <div class="d-flex justify-content-center align-items-center gap-3 mb-3 flex-wrap">
      <label for="currency-picker" class="fs-5 mb-0">Currency:</label>
      <select id="currency-picker" class="form-select form-select-sm w-auto" aria-label="Currency select">
        <option value="USD" selected>USD</option>
        <option value="EUR">EUR</option>
        <option value="GBP">GBP</option>
        <option value="JPY">JPY</option>
        <option value="AUD">AUD</option>
        <option value="CAD">CAD</option>
      </select>

      <label for="region-filter" class="fs-5 mb-0 ms-3">Region:</label>
      <select id="region-filter" class="form-select form-select-sm w-auto" aria-label="Region filter">
        <option value="all" selected>All</option>
        <option value="north-america">North America</option>
        <option value="europe">Europe</option>
        <option value="asia">Asia</option>
        <option value="australia">Australia</option>
      </select>

      <div class="fs-5 ms-3">
        Active currency: <span id="total-currency">USD</span>
      </div>
    </div>
    <div class="alert alert-primary fs-3 text-center" role="alert">
      Total Sales (<span id="region-name">All regions</span>): <span id="total-sales" data-region="all">Loading...</span>
    </div>

    <div class="table-responsive">
      <table id="product-sales" class="table table-striped table-bordered align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Product</th>
            <th>Total Sales</th>
          </tr>
        </thead>
        <tbody>
          <!-- Filled dynamically -->
        </tbody>
        <tfoot class="table-secondary fw-semibold">
          <tr>
            <td>Total</td>
            <td id="footer-total-sales">0.00</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <script>
    (() => {
      const currencyPicker = document.getElementById('currency-picker');
      const totalCurrencyEl = document.getElementById('total-currency');
      const totalSalesEl = document.getElementById('total-sales');
      const footerTotalSalesEl = document.getElementById('footer-total-sales');
      const productSalesTbody = document.querySelector('#product-sales tbody');
      const regionFilter = document.getElementById('region-filter');
      const regionNameEl = document.getElementById('region-name');

      // Currency exchange rates relative to USD
      const exchangeRates = {
        USD: 1,
        EUR: 0.92,
        GBP: 0.79,
        JPY: 137.13,
        AUD: 1.48,
        CAD: 1.36,
      };

      // Products sales data: product, sales (USD), region
      const salesData = [
        { product: "Laptop", salesUSD: 120000, region: "north-america" },
        { product: "Smartphone", salesUSD: 175000, region: "europe" },
        { product: "Tablet", salesUSD: 90000, region: "asia" },
        { product: "Monitor", salesUSD: 65000, region: "north-america" },
        { product: "Printer", salesUSD: 30000, region: "europe" },
        { product: "Headphones", salesUSD: 45000, region: "asia" },
        { product: "Camera", salesUSD: 40000, region: "australia" },
        { product: "Smartwatch", salesUSD: 25000, region: "north-america" },
        { product: "Keyboard", salesUSD: 15000, region: "europe" },
      ];

      // Region display names
      const regionDisplayNames = {
        "all": "All regions",
        "north-america": "North America",
        "europe": "Europe",
        "asia": "Asia",
        "australia": "Australia"
      };

      // Format money with Intl.NumberFormat
      function formatMoney(value, currency) {
        return new Intl.NumberFormat(undefined, {
          style: 'currency',
          currency,
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        }).format(value);
      }

      // Render sales rows filtered by region with converted currency
      function renderSalesRows(region, currency) {
        // Clear existing rows
        productSalesTbody.innerHTML = "";

        // Filter products per region
        const filtered = region === 'all'
          ? salesData
          : salesData.filter(item => item.region === region);

        // Map to converted and formatted rows
        filtered.forEach(({ product, salesUSD }) => {
          const converted = salesUSD * exchangeRates[currency];
          const tr = document.createElement('tr');

          const tdProduct = document.createElement('td');
          tdProduct.textContent = product;
          tdProduct.scope = "row";

          const tdSales = document.createElement('td');
          tdSales.textContent = formatMoney(converted, currency);

          tr.appendChild(tdProduct);
          tr.appendChild(tdSales);
          productSalesTbody.appendChild(tr);
        });

        return filtered;
      }

      // Calculate and update totals
      function updateTotals(region, currency) {
        const filtered = region === 'all'
          ? salesData
          : salesData.filter(item => item.region === region);

        const totalUSD = filtered.reduce((acc, cur) => acc + cur.salesUSD, 0);
        const convertedTotal = totalUSD * exchangeRates[currency];

        // Update footer total sales cell
        footerTotalSalesEl.textContent = formatMoney(convertedTotal, currency);

        // Update total sales alert
        totalSalesEl.textContent = formatMoney(convertedTotal, currency);
        totalSalesEl.dataset.region = region;

        regionNameEl.textContent = regionDisplayNames[region] || region;
      }

      // Event handler for currency or region change
      function handleFilterChange() {
        const selectedCurrency = currencyPicker.value;
        const selectedRegion = regionFilter.value;

        renderSalesRows(selectedRegion, selectedCurrency);
        updateTotals(selectedRegion, selectedCurrency);
        totalCurrencyEl.textContent = selectedCurrency;
      }

      // Initial render
      (() => {
        handleFilterChange();
      })();

      currencyPicker.addEventListener('change', handleFilterChange);
      regionFilter.addEventListener('change', handleFilterChange);
    })();
  </script>
</body>
</html>