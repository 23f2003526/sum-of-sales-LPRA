<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sales Summary 123123</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<style>
  body {
    min-height: 100vh;
  }
</style>
</head>
<body class="bg-light d-flex flex-column justify-content-center align-items-center py-5">
  <div class="container">
    <h1 class="mb-4 text-center">Sales Summary 123123</h1>
    <div class="d-flex justify-content-center align-items-center gap-3 mb-3 flex-wrap">
      <label for="currency-picker" class="fs-5 mb-0">Currency:</label>
      <select id="currency-picker" class="form-select form-select-sm w-auto" aria-label="Currency select">
        <option value="USD" selected>USD</option>
        <option value="EUR">EUR</option>
        <option value="GBP">GBP</option>
        <option value="JPY">JPY</option>
        <option value="AUD">AUD</option>
        <option value="CAD">CAD</option>
      </select>
      <div class="fs-5 ms-3">
        Active currency: <span id="total-currency">USD</span>
      </div>
    </div>
    <div class="alert alert-primary fs-3 text-center" role="alert">
      Total Sales: <span id="total-sales">Loading...</span>
    </div>

    <div class="table-responsive">
      <table id="product-sales" class="table table-striped table-bordered align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Product</th>
            <th>Total Sales</th>
          </tr>
        </thead>
        <tbody>
          <!-- Filled dynamically -->
        </tbody>
        <tfoot class="table-secondary fw-semibold">
          <tr>
            <td>Total</td>
            <td id="footer-total-sales">0.00</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <script>
    (() => {
      const currencyPicker = document.getElementById('currency-picker');
      const totalCurrencyEl = document.getElementById('total-currency');
      const totalSalesEl = document.getElementById('total-sales');
      const footerTotalSalesEl = document.getElementById('footer-total-sales');
      const tableBody = document.querySelector('#product-sales tbody');

      // Sample product sales data in USD (base)
      const productSalesUSD = [
        { product: 'Widget', total: 1234.56 },
        { product: 'Gadget', total: 987.65 },
        { product: 'Doohickey', total: 456.78 },
        { product: 'Thingamajig', total: 321.45 },
        { product: 'Whatsit', total: 654.32 },
      ];

      let rates = {
        "USD": 1,
        "EUR": 0.91,
        "GBP": 0.77,
        "JPY": 146.56,
        "AUD": 1.46,
        "CAD": 1.33
      };

      // Number formatter cache by currency code
      const formatters = {};

      function currencyFormatter(currencyCode) {
        if (!formatters[currencyCode]) {
          formatters[currencyCode] = new Intl.NumberFormat(undefined, {
            style: 'currency',
            currency: currencyCode,
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          });
        }
        return formatters[currencyCode];
      }

      function updateTableAndTotals(selectedCurrency) {
        const rate = rates[selectedCurrency];
        if (typeof rate !== 'number' || rate <= 0) return;

        // Clear table body
        tableBody.innerHTML = '';

        // Calculate totals and fill rows
        let totalSumBase = 0;
        productSalesUSD.forEach(item => {
          totalSumBase += item.total;
          const convertedTotal = item.total * rate;
          const tr = document.createElement('tr');
          const tdProduct = document.createElement('td');
          tdProduct.textContent = item.product;
          const tdTotal = document.createElement('td');
          tdTotal.textContent = currencyFormatter(selectedCurrency).format(convertedTotal);
          tr.appendChild(tdProduct);
          tr.appendChild(tdTotal);
          tableBody.appendChild(tr);
        });

        // Update footer total (convert base total)
        const totalConverted = totalSumBase * rate;

        footerTotalSalesEl.textContent = currencyFormatter(selectedCurrency).format(totalConverted);

        // Update total sales alert
        totalSalesEl.textContent = currencyFormatter(selectedCurrency).format(totalConverted);

        // Update active currency display
        totalCurrencyEl.textContent = selectedCurrency;
      }

      function onCurrencyChange() {
        const selectedCurrency = currencyPicker.value;
        updateTableAndTotals(selectedCurrency);
      }

      // Initialize app
      function init() {
        // Load rates from the included data (could be extended for async fetching)
        if (!rates || typeof rates !== 'object') {
          totalSalesEl.textContent = 'Error loading rates';
          return;
        }

        // Initialize table and total
        updateTableAndTotals(currencyPicker.value);

        // Add event listener on currency picker
        currencyPicker.addEventListener('change', onCurrencyChange);
      }

      init();
    })();
  </script>
</body>
</html>